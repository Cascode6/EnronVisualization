
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Enron Data Visualization</title>
        <script src="/d3.js"></script>
        <script src="dimple.min.js"></script>
        <style type="text/css">
		    circle:hover {
                fill: orange;
            }
			
		</style>
        
    </head>
    <body style="text-align: center;">
        <header ><h1>Visualizing Fraud Connections</h1>
        <h3>A look at the email connections of Enron Fraud persons of interest</h3>
        <h5>By Casey Faist<br>Adapted from my <a href="https://github.com/Cascode6/EnronDataAnalysis">machine learning investigation</a> of the financial data associated with the Enron investigation and the email corpus</h5>
        </header>
        <section>
            <p>The Enron data poses a few key challenges to a machine learning task. At first glance, it's easy to assume that if a suspect sent more emails, the more likely they were to have been involved in the fraud - they were doing more wheeling and dealing, perhaps, or were higher up in the company.</p>
            <p>However, based on the importance scores of my examination, the top 5 predictive features are all financial:</p>
            <p>Multiplied Stock (total stock value * exercised stock options)<br>
            Total Stock Value<br>
            Exercised Stock Value<br>
            Yearly Bonus<br>
            Salary<br></p>
            <p>in that order. The relationship which seemed to most often correlate with a Person of Interest (or POI) was the variation between exercised stock holdings and total stock value -- those who had more of their stock as exercised stock holdings, as opposed to restricted stock holdings, seemed to more often be POIs.</p>
        </section>
        <div id="features" style="text-align: center;">
            <h2>Finanical Features Comparison</h2>
        </div>
        <div id="nodes" style="text-align: center;">
            <h2>Email Connections</h2>
            <p>However, its entirely possible that many more people committed fraud on a less obvious scale, or hid the results somewhere besides their stock options. With only 18 targets in a pool of 145, the conclusions we can draw are tentative at best. for the whole picture, we need to look at relationships between the people.</p>
        </div>
        <script type="text/javascript">
            
            d3.json("visData.json", function(error, json) {
                if (error) {return console.warn(error)};
                data = json;
                draw(data);
                });
            
            function draw(data){
                
                var w = 500;
                    h = 50;
                    data;
                    width = 600;
                    height = 600;
                
                
                
                var svg = d3.select("#nodes")
                            .append("svg")
                            .attr("width", width)
                            .attr("height", height);
                
                var originX = width / 2;
                var originY = height / 2;
                var CircleRadius = width / 2 - (width / 20);
                    
                var len = data.nodes.length;

                var people = svg.selectAll(".node")
                                    .data(data.nodes)
                                    .enter()
                                    .append("circle")
                                    .attr("class", "node")
                                    .attr("id", function(d){return d["Email"]})
                                    .attr("cx", function(d, i){
                                        return originX + ((CircleRadius) * Math.sin(2*Math.PI*i/len))})
                                    .attr("cy", function(d, i){
                                        return originY + ((CircleRadius) * Math.cos(2*Math.PI*i/len))})
                                    .attr("opacity", 1)
                                    .attr("r", 5)
                                    .attr("stroke", function(d){
                                        if (d.Name === "other") {
                                            return "black";
                                        } else {
                                            return "none";
                                        }
                                    
                                    })
                                    .attr("fill", function(d) {
                                        if (d.Name === "other") {
                                            return "none"
                                        } else {
                                        if (d["Is POI"] === true) {   
                                            return "red";
                                        } else {
                                            return "steelblue";
                                        }
                                        }
                                    });
                                 
                var emails = svg.selectAll(".link")
                                    .data(data.links)
                                    .enter()
                                    .append("line")
                                    .attr("class", "link")
                                    .attr("id", function(d){
                                        try {
                                            console.log("success!");
                                            svg.select("circle#"+d.sender);
                                            return d.sender;
                                        }
                                        
                                        catch(err){
                                            console.log("error!");
                                            return "other";
                                        };
                                    })
                                    .attr("x1", function(d){ console.log(d.sender);
                                                            try {
                                                                console.log("success!");
                                                                console.log(svg.select("circle#"+d.sender).attr("cx"));
                                                                return svg.select("circle#"+d.sender).attr("cx");
                                                            }
                                                            
                                                            catch(err){
                                                                console.log("error!");
                                                            };
                                                        })
                                    .attr("y1", function(d){ 
                                                            try {
                                                                console.log("success!");
                                                                console.log(svg.select("circle#"+d.sender).attr("cy"));
                                                                return svg.select("circle#"+d.sender).attr("cy");
                                                            }
                                                            
                                                            catch(err){
                                                                console.log("error!");
                                                            }; })
                                    .attr("x2", function(d){ console.log(d.receiver);
                                                            try {
                                                                console.log("success!");
                                                                console.log(svg.select("circle#"+d.receiver).attr("cx"));
                                                                return svg.select("circle#"+d.receiver).attr("cx");
                                                            }
                                                            
                                                            catch(err){
                                                                console.log("error!");
                                                            }; })
                                    .attr("y2", function(d){ 
                                                            try {
                                                                console.log("success!");
                                                                console.log(svg.select("circle#"+d.receiver).attr("cy"));
                                                                return svg.select("circle#"+d.receiver).attr("cy");
                                                            }
                                                            
                                                            catch(err){
                                                                console.log("error!");
                                                            }; })
                                    .attr("stroke", function(d){
                                                            
                                                                console.log(svg.select("circle#"+d.sender).attr("fill"));
                                                                if (svg.select("circle#"+d.sender).attr("fill") != "undefined"){
                                                                    var senderData = svg.select("circle#"+d.sender).attr("fill")
                                                                } else {
                                                                    var senderData = "none"
                                                                }
                                                            
                                                                console.log(svg.select("circle#"+d.receiver).attr("fill"));
                                                                if (svg.select("circle#"+d.receiver).attr("fill") != "undefined"){
                                                                    var receiverData = svg.select("circle#"+d.receiver).attr("fill")
                                                                } else {
                                                                    var receiverData = "none"
                                                                }
                                                       
                                        console.log(senderData);
                                        console.log(receiverData);
                                        
                                        if (senderData === receiverData) {
                                            return senderData;
                                        } 
                                        else if (senderData === "none") {
                                            return senderData;
                                        }
                                        else if(receiverData === "none") {
                                            return receiverData;
                                        }
                                        else {
                                            return "red"
                                        }
                                        
                                    });
                
                svg.selectAll("rect")
                    .data(data.nodes)
                    .enter()
                    .append("rect")
                    .attr("id", "tooltip")
                    .attr("x", 60)
                    .attr("y", 40)
                    .attr("stroke", "black");
                
                svg.selectAll("circle")
                  .on("mouseover", function(d){
                        console.log(this.__data__);
                        svg.selectAll("rect")
                            .data(this.__data__)
                            .enter()
                            
                            .append("text")
                            .attr("text-anchor", "middle")
                            .attr("font-family", "sans-serif")
                            .attr("font-size", "11px")
                            .attr("font-weight", "bold")
                            .attr("fill", "black")
                            .text(d);
                  });
                //   .on("mouseout", function() {
                //         //Remove the tooltip
                //         d3.select("#tooltip").remove();
                //         });
                
                
                
                
                d3.select("#other.node")
                    .on("mouseover", function(){
                        svg.selectAll("#other")
                           .transition()
                           .duration("5000")
                           .ease("linear")
                           .attr("fill", "grey")
                           .attr("stroke", "black");
                    })
                    .on("mouseout", function(){
                        svg.selectAll("#other")
                           .transition()
                           .duration("5000")
                           .ease("linear")
                           .attr("fill", "lightgray")
                           .attr("stroke", "none");
                    })
                
                
                
                
                // // the chart areas
                var another = dimple.newSvg("#nodes", 700, 600);
                var newsvg = dimple.newSvg("#features", 1400, 600);
                console.log(data.poinodes)
                
                var stockChart = new dimple.chart(newsvg, data.aboveav);
                
                var linkChart = new dimple.chart(another, data.poilinks);
                
                stockChart.setBounds(60, 10, 1300, 410);
                stockChart.addCategoryAxis("x", "Name");
                stockChart.addMeasureAxis("y", "Total Stock Value");
                // stockChart.addMeasureAxis("z", "Exercised Stock Options");
                stockChart.addSeries(["Is POI"], dimple.plot.scatter);
                
                stockChart.defaultColors = [
                    new dimple.color("#e74c3c", "#c0392b", 1), // red
                    new dimple.color("#3498db", "#2980b9", 1), // blue
                    new dimple.color("#2ecc71", "#27ae60", 1), // green
                    new dimple.color("#9b59b6", "#8e44ad", 1), // purple
                    new dimple.color("#e67e22", "#d35400", 1), // orange
                    new dimple.color("#f1c40f", "#f39c12", 1), // yellow
                    new dimple.color("#1abc9c", "#16a085", 1), // turquoise
                    new dimple.color("#95a5a6", "#7f8c8d", 1)  // gray
                ];
                
                
                linkChart.setBounds(150, 45, 510, 315);
                linkChart.addCategoryAxis("x", "sender");
                linkChart.addCategoryAxis("y", "receiver");
                linkChart.addSeries(["rPOI", "sPOI"], dimple.plot.bubble);
                linkChart.defaultColors = [
                    new dimple.color("#3498db", "#2980b9", 1), // blue
                    new dimple.color("#e74c3c", "#c0392b", 1), // red
                    new dimple.color("#2ecc71", "#27ae60", 1), // green
                    new dimple.color("#9b59b6", "#8e44ad", 1), // purple
                    new dimple.color("#e67e22", "#d35400", 1), // orange
                    new dimple.color("#f1c40f", "#f39c12", 1), // yellow
                    new dimple.color("#1abc9c", "#16a085", 1), // turquoise
                    new dimple.color("#95a5a6", "#7f8c8d", 1)  // gray
                ];
        // http://dimplejs.org/advanced_examples_viewer.html?id=advanced_custom_styling
                
                
                
                // // Handle the hover event - overriding the default behaviour
                // s.addEventHandler("mouseover", onHover);
                // // Handle the leave event - overriding the default behaviour
                // s.addEventHandler("mouseleave", onLeave);
                
                linkChart.draw();
                stockChart.draw();
                
                
                // function onHover(e) {
                //     // Get the properties of the selected shape
                //     var x = parseFloat(e.selectedShape.attr("x")),
                //         y = parseFloat(e.selectedShape.attr("y")),
                //         r = parseFloat(e.selectedShape.attr("r")),
                //         fill = e.selectedShape.attr("fill"),
                //         stroke = e.selectedShape.attr("stroke");
                        
                //     // Set the size and position of the popup
                //     var width = 150,
                //         height = 100,
                //         x = (cx + r + width + 10 < svg.attr("width") ?
                //             cx + r + 10 :
                //             cx - r - width - 20);
                //         y = (cy - height / 2 < 0 ?
                //             15 :
                //             cy - height / 2);
                            
                //     // Fade the popup fill mixing the shape fill with 80% white
                //     var popupFillColor = d3.rgb(
                //                 d3.rgb(fill).r + 0.8 * (255 - d3.rgb(fill).r),
                //                 d3.rgb(fill).g + 0.8 * (255 - d3.rgb(fill).g),
                //                 d3.rgb(fill).b + 0.8 * (255 - d3.rgb(fill).b)
                //             );
                            
                //     // Create a group for the popup objects
                //     popup = svg.append("g");
                    
                //     // Add a rectangle surrounding the chart
                //     popup
                //     .append("rect")
                //     .attr("x", x + 5)
                //     .attr("y", y - 5)
                //     .attr("width", width)
                //     .attr("height", height)
                //     .attr("rx", 5)
                //     .attr("ry", 5)
                //     .style("fill", popupFillColor)
                //     .style("stroke", stroke)
                //     .style("stroke-width", 2);
                    
                //     // Add the series value text
                //     popup
                //     .append("text")
                //     .attr("x", x + 10)
                //     .attr("y", y + 10)
                //     .text("will eventually mean something!")
                //     .style("font-family", "sans-serif")
                //     .style("font-size", 10)
                //     .style("fill", stroke);
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                //     // Event to handle mouse exit
                //     function onLeave(e) {
                //         // Remove the chart
                //         if (tipChart !== null) {
                //         tipChart._group.remove();
                //         }
                //         // Remove the popup
                //         if (popup !== null) {
                //         popup.remove();
                //         }
                //     };
                // }
            }
        </script>
    </body>
</html>   
